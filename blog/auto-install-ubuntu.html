<!DOCTYPE html>
<html lang="en">

  <head>
      <title>chrooted.net</title>
      <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,700italic,400,600,700' rel='stylesheet' type='text/css' />
      <link href='http://fonts.googleapis.com/css?family=Merriweather:300' rel='stylesheet' type='text/css'/>
      <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:200,400,700' rel='stylesheet' type='text/css'/>
      <link rel="stylesheet" type="text/css" href="http://chrooted.net/theme/css/icons.css"/>
      <link rel="stylesheet" type="text/css" href="http://chrooted.net/theme/css/styles.css"/>
      <meta charset="utf-8" />
        <link href="/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="chrooted.net RSS Feed" />
  </head>

  <body id="index">
    <!-- header -->
    <header class="siteheader">
      <!-- site image -->
        <div class= "siteimage">
          <a class="nodec" href=https://secure.gravatar.com/avatar/566e0ab0119d534d05abbcf61d316d28?s=300>
            <img width="200" height="200" src=https://secure.gravatar.com/avatar/566e0ab0119d534d05abbcf61d316d28?s=300>
          </a>
        </div>

      <div class = "sitebanner">
        <h1><a class="sitetitle nodec" href="http://chrooted.net">chrooted.net</a></h1>
        <h3 class ="sitesubtitle">by Patrick Pelletier</h3>
        <!-- nav -->
        <nav class="menu">
          <ul>
            <!-- menu items-->
              <li><a class="nodec" href="/">blog</a></li>
            <!--pages-->
                <li><a class="nodec" href="http://chrooted.net/pages/about.html">about</a></li>
            <!-- services icons -->
              <li><a class="nodec icon-github" href="https://github.com/skinp"></a></li>
              <li><a class="nodec icon-twitter" href="https://twitter.com/skinp"></a></li>
              <li><a class="nodec icon-rss" href="/feeds/rss.xml"></a></li>
          </ul>
        </nav>
      </div> <!-- sitebanner -->
    </header>

    <!-- content -->

<section class="content">

  <h3 class="posttitle">
    <a class="nodec" href="/blog/auto-install-ubuntu.html" rel="bookmark" title="Permalink to No questions asked UbuntuÂ install">
      No questions asked Ubuntu&nbsp;install
    </a>
  </h3>

  <div class="postinfo">
    <p class="published" title="2013-12-13T00:00:00">
      Fri 13 December 2013
    </p>

  </div><!-- .postinfo -->

  <div class="article">
    <p>Still in the process of correctly provisioning and configuring my Homelab and <span class="caps">VPS</span> with <a href="http://www.ansibleworks.com/">Ansible</a>, I ended up having to often reinstall servers just to make sure my playbooks were still working after a lot of edit+deploy iterations. I was really tired of having to log into the <span class="caps">VNC</span> console of my <span class="caps">VPS</span> providers and manually run through the whole <span class="caps">ISO</span>&nbsp;setup.</p>
<p>So today I decided I would take a break from coding Ansible playbooks and try to automate the provisioning of these servers <span class="caps">ALA</span> Kickstart&#8230; The&nbsp;goal:</p>
<p><strong><span class="caps">NO</span> <span class="caps">QUESTIONS</span>&nbsp;<span class="caps">ASKED</span></strong></p>
<p>So after a couple of iterations (again!!!), here is my preseed.cfg tested on <a href="http://www.ubuntu.com/download/server">Ubuntu 12.04 <span class="caps">LTS</span> x86_64</a>:</p>
<div class="highlight"><pre><span class="cp">## Options to set on the command line</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">debian</span><span class="o">-</span><span class="n">installer</span><span class="o">/</span><span class="n">locale</span> <span class="n">string</span> <span class="n">en_US</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">console</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">ask_detect</span> <span class="n">boolean</span> <span class="nb">false</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">console</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">layoutcode</span> <span class="n">string</span> <span class="n">us</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">keyboard</span><span class="o">-</span><span class="n">configuration</span><span class="o">/</span><span class="n">layoutcode</span> <span class="n">string</span> <span class="n">us</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">netcfg</span><span class="o">/</span><span class="n">get_hostname</span> <span class="n">string</span> <span class="n">unassigned</span><span class="o">-</span><span class="n">hostname</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">netcfg</span><span class="o">/</span><span class="n">get_domain</span> <span class="n">string</span> <span class="n">unassigned</span><span class="o">-</span><span class="n">domain</span>

<span class="cp">## Network config</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">netcfg</span><span class="o">/</span><span class="n">choose_interface</span> <span class="n">select</span> <span class="k">auto</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">netcfg</span><span class="o">/</span><span class="n">dhcp_timeout</span> <span class="n">string</span> <span class="mi">60</span>

<span class="cp">## Kernel</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">base</span><span class="o">-</span><span class="n">installer</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">override</span><span class="o">-</span><span class="n">image</span> <span class="n">string</span> <span class="n">linux</span><span class="o">-</span><span class="n">server</span>

<span class="cp">## Clock</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">clock</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">utc</span><span class="o">-</span><span class="k">auto</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">clock</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">utc</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">time</span><span class="o">/</span><span class="n">zone</span> <span class="n">string</span> <span class="n"><span class="caps">US</span></span><span class="o">/</span><span class="n">Eastern</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">clock</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">ntp</span> <span class="n">boolean</span> <span class="nb">true</span>

<span class="cp">## Mirrors</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">mirror</span><span class="o">/</span><span class="n">country</span> <span class="n">string</span> <span class="n"><span class="caps">US</span></span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">mirror</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="n">proxy</span> <span class="n">string</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">mirror</span><span class="o">/</span><span class="n">protocol</span> <span class="n">string</span> <span class="n">http</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">mirror</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="n">mirror</span> <span class="n">select</span> <span class="n">us</span><span class="p">.</span><span class="n">archive</span><span class="p">.</span><span class="n">ubuntu</span><span class="p">.</span><span class="n">com</span>

<span class="cp">## Partitions</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="k">auto</span><span class="o">/</span><span class="n">method</span> <span class="n">string</span> <span class="n">lvm</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="k">auto</span><span class="o">/</span><span class="n">purge_lvm_from_device</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="k">auto</span><span class="o">/</span><span class="n">choose_recipe</span> <span class="n">select</span> <span class="n">atomic</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">/</span><span class="n">default_filesystem</span> <span class="n">string</span> <span class="n">ext4</span>

<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="k">auto</span><span class="o">-</span><span class="n">lvm</span><span class="o">/</span><span class="n">guided_size</span> <span class="n">string</span> <span class="n">max</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="n">lvm</span><span class="o">/</span><span class="n">device_remove_lvm</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">-</span><span class="n">lvm</span><span class="o">/</span><span class="n">confirm</span> <span class="n">boolean</span> <span class="nb">true</span>

<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">/</span><span class="n">choose_partition</span> <span class="n">select</span> <span class="n">finish</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">/</span><span class="n">confirm_write_new_label</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">partman</span><span class="o">/</span><span class="n">confirm</span> <span class="n">boolean</span> <span class="nb">true</span>

<span class="cp">## User accounts</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">root</span><span class="o">-</span><span class="n">login</span> <span class="n">boolean</span> <span class="nb">false</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">fullname</span> <span class="n">string</span> <span class="n">ubuntu</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">username</span> <span class="n">string</span> <span class="n">ubuntu</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">uid</span> <span class="n">string</span> <span class="mi">1000</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">password</span> <span class="n">password</span> <span class="n">change_me_please</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">passwd</span><span class="o">/</span><span class="n">user</span><span class="o">-</span><span class="n">password</span><span class="o">-</span><span class="n">again</span> <span class="n">password</span> <span class="n">change_me_please</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">user</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">allow</span><span class="o">-</span><span class="n">password</span><span class="o">-</span><span class="n">weak</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">user</span><span class="o">-</span><span class="n">setup</span><span class="o">/</span><span class="n">encrypt</span><span class="o">-</span><span class="n">home</span> <span class="n">boolean</span> <span class="nb">false</span>

<span class="cp">## Packages to install</span>
<span class="n">tasksel</span> <span class="n">tasksel</span><span class="o">/</span><span class="n">first</span> <span class="n">multiselect</span> <span class="n">standard</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="n">server</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">pkgsel</span><span class="o">/</span><span class="n">install</span><span class="o">-</span><span class="n">language</span><span class="o">-</span><span class="n">support</span> <span class="n">boolean</span> <span class="nb">false</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">pkgsel</span><span class="o">/</span><span class="n">include</span> <span class="n">string</span> <span class="n">openssh</span><span class="o">-</span><span class="n">server</span>

<span class="cp">## Install security updates automatically</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">pkgsel</span><span class="o">/</span><span class="n">update</span><span class="o">-</span><span class="n">policy</span> <span class="n">select</span> <span class="n">unattended</span><span class="o">-</span><span class="n">upgrades</span>

<span class="cp">## Grub setup</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">grub</span><span class="o">-</span><span class="n">installer</span><span class="o">/</span><span class="n">only_debian</span> <span class="n">boolean</span> <span class="nb">true</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">grub</span><span class="o">-</span><span class="n">installer</span><span class="o">/</span><span class="n">with_other_os</span> <span class="n">boolean</span> <span class="nb">true</span>

<span class="cp">## Avoid that last message about the install being complete.</span>
<span class="n">d</span><span class="o">-</span><span class="n">i</span> <span class="n">finish</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="n">reboot_in_progress</span> <span class="n">note</span>
</pre></div>


<p>You can view the meaning of all these statements <a href="https://help.ubuntu.com/lts/installation-guide/i386/preseed-contents.html">here</a>.</p>
<p>Unfortunatly, this process still isn&#8217;t fully automated. Since the network setup only happens after some questions are asked (notably language and keyboard layout), we have to give some additionnal parameters to the boot prompt (<strong>After the <span class="caps">CD</span> boots, select the language then F6</strong>). The boot line should look like the following (all on one line without&nbsp;&#8217;&#39;):</p>
<div class="highlight"><pre><span class="n">url</span><span class="o">=</span><span class="n">http</span><span class="o">:</span><span class="c1">//webserver.domain/path/preseed.cfg \</span>
<span class="c1">debian-installer/locale=en_US \</span>
<span class="c1">console-setup/ask_detect=false \</span>
<span class="c1">console-setup/layoutcode=us \</span>
<span class="c1">keyboard-configuration/layoutcode=us \</span>
<span class="c1">hostname=<span class="caps">YOURHOSTNAME</span> \</span>
<span class="c1">domain=<span class="caps">YOURDOMAINE</span> \</span>
<span class="c1">initrd=/install/initrd.gz quiet --</span>
</pre></div>


<p>In my opinion, it&#8217;s still a lot better than having to go through the whole setup. Especially now that I can add some additionnal configuration (installed packages, user groups&#8230;) at provision&nbsp;time!</p>
  </div><!-- .content -->

</section>


    <!-- footer -->
    <footer>
      <p>
        Â© Patrick Pelletier, license <a href="https://creativecommons.org/licenses/by-sa/3.0/"> CC BY-SA</a>
        unless otherwise noted.
        Generated by <a href= "http://docs.getpelican.com/">Pelican</a> with
        <a href="http://github.com/porterjamesj/crowsfoot">crowsfoot</a> theme.
      </p>
    </footer>
  </body>
</html>